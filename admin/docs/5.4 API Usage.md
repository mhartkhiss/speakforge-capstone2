# 5.4 API Usage

## Front-end Components

- **ApiUsageStatistics**: API analytics dashboard component
  - Overall statistics cards showing total requests, tokens, and costs
  - Model breakdown table with usage by AI provider
  - Daily usage charts and trends
  - Currency conversion display (USD to PHP)

- **Statistics Cards**: API metrics display
  - Total API requests counter with large typography
  - Total tokens used across all API calls
  - Cost breakdown with currency formatting
  - Provider-specific usage indicators

- **Model Breakdown Table**: AI provider usage details
  - Tabular display of Claude vs Gemini API usage
  - Cost per model with percentage breakdowns
  - Usage statistics and token consumption
  - Color-coded provider identification

- **Daily Usage Charts**: Time-based API consumption
  - Daily API call volume visualization
  - Token usage trends over time
  - Cost accumulation charts
  - Interactive chart controls and filtering

## Back-end Components

- **API Usage Tracking API**: Usage analytics endpoints
  - GET /admin/api-usage/overview/ - Overall API statistics
  - GET /admin/api-usage/models/ - Model-specific breakdown
  - GET /admin/api-usage/daily/ - Daily usage trends
  - GET /admin/api-usage/costs/ - Cost analysis data

- **API Usage Logging**: Real-time usage tracking
  - Translation API call interception and logging
  - Token consumption recording per request
  - Cost calculation based on provider pricing
  - Request metadata storage (user, timestamp, model)

- **Cost Calculation Engine**: Pricing and billing logic
  - Dynamic pricing based on AI provider rates
  - Currency conversion (USD to PHP) with exchange rates
  - Token-based cost calculation algorithms
  - Cost aggregation by time periods and providers

- **Usage Analytics Processing**: Data aggregation and reporting
  - Time-based usage aggregation (daily, weekly, monthly)
  - Model performance and cost efficiency analysis
  - User-based API usage tracking
  - Trend analysis and forecasting

## Plant UML Diagrams

### Class Diagram (MVC Model)

```plantuml
@startuml API Usage Class Diagram

class "Model" as Model {
  - Classes: API Usage API, Usage Logger,
    Cost Calculator, Analytics Processor
  - Methods: fetchApiStats(), calculateCosts(),
    aggregateUsage(), processTrends(),
    convertCurrency()
}

class "View" as View {
  - Classes: ApiUsageStatistics, Statistics Cards,
    Model Breakdown Table, Usage Charts,
    Material-UI Components
  - Layouts: ApiUsageStatistics.jsx
  - Elements: totalRequestsCard, tokensCard, costCard,
    modelTable, dailyChart, providerBreakdown
  - Methods: renderStats(), updateCharts(),
    formatCurrency(), displayTrends()
}

class "Controller" as Controller {
  - Classes: AdminDashboard API usage logic
  - Methods: loadApiUsage(), handlePeriodChange(),
    refreshUsageData(), processApiStats(),
    calculateTotals()
}

Model --> Controller : provides usage data
Controller --> View : updates statistics display
View --> Controller : user interactions

@enduml
```

### Sequence Diagram

```plantuml
@startuml API Usage Sequence Diagram

actor Admin
participant AdminDashboard
participant APIUsageAPI
participant ApiUsageStatistics
participant CostCalculator

Admin -> AdminDashboard: Access API usage tab
AdminDashboard -> APIUsageAPI: GET /admin/api-usage/overview/
APIUsageAPI --> AdminDashboard: Return overall statistics
AdminDashboard -> ApiUsageStatistics: Set API statistics
ApiUsageStatistics -> ApiUsageStatistics: Render statistics cards

AdminDashboard -> APIUsageAPI: GET /admin/api-usage/models/
APIUsageAPI --> AdminDashboard: Return model breakdown
AdminDashboard -> CostCalculator: Calculate costs by model
CostCalculator --> AdminDashboard: Return cost breakdown
AdminDashboard -> ApiUsageStatistics: Update model table

AdminDashboard -> APIUsageAPI: GET /admin/api-usage/daily/
APIUsageAPI --> AdminDashboard: Return daily usage data
AdminDashboard -> ApiUsageStatistics: Update daily charts

@enduml
```

### Data Design Diagram

```plantuml
@startuml API Usage Data Design Diagram

database "API Usage Logs" as APIUsageDB {
  api_requests : ApiRequest
  usage_metrics : UsageMetric
}

class ApiUsageStats {
  +total_requests : number
  +total_tokens : number
  +total_cost_usd : number
  +total_cost_php : number
  +model_breakdown : List<ModelUsage>
  +daily_stats : List<DailyUsage>
}

class ModelUsage {
  +model : String <<claude/gemini>>
  +requests : number
  +tokens : number
  +cost_usd : number
  +cost_php : number
  +percentage : number
}

class DailyUsage {
  +date : String
  +requests : number
  +tokens : number
  +cost : number
  +models_used : String[]
}

class ApiRequest {
  +requestId : String <<PK>>
  +userId : String
  +model : String
  +tokens_used : number
  +cost_usd : number
  +timestamp : Long
  +endpoint : String
}

ApiRequest --> ApiUsageStats : aggregated into
ModelUsage --> ApiUsageStats : included in
DailyUsage --> ApiUsageStats : included in

@enduml
```
