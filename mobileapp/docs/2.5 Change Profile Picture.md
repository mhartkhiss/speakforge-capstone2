# 2.5 Change Profile Picture

## Front-end Components

- **ProfileFragment**: Profile screen with profile picture display
  - Profile ImageView: Shows current user profile picture
  - Image click handler: Triggers image selection when tapped

- **ChangeProfilePicControl**: Controller managing profile picture operations
  - Image picker Intent: Opens device image gallery
  - ProgressDialog: Shows upload progress
  - Image display update: Refreshes UI after successful upload

- **UI Layout (fragment_profile.xml)**: Profile screen layout
  - Elements: imageViewUserPicture, cardViewProfile
  - Image loading: Uses Glide for profile picture display

## Back-end Components

- **FirebaseStorage**: Cloud storage for profile images
  - profile_pictures/{userId} reference: User-specific image storage
  - putFile(): Uploads selected image to cloud storage
  - getDownloadUrl(): Retrieves public URL of uploaded image

- **FirebaseDatabase**: Stores profile picture URL
  - users/{userId}/profileImageUrl reference: Image URL storage
  - setValue(): Updates profile picture URL in user profile

- **ChangeProfilePicControl**: Business logic for image management
  - selectImage(): Initiates image selection from device
  - uploadImage(): Handles image upload to Firebase Storage
  - updateProfilePicture(): Saves image URL to user profile

## Plant UML Diagrams

### Class Diagram (MVC Model)

```plantuml
@startuml Change Profile Picture Class Diagram

class "Model" as Model {
  - Classes: FirebaseStorage.java, FirebaseDatabase.java
  - Methods: getReference(), putFile(), getDownloadUrl(),
    setValue(), addOnSuccessListener(), addOnFailureListener()
}

class "View" as View {
  - Classes: ProfileFragment.java, ProgressDialog.java, Glide.java
  - Layouts: fragment_profile.xml
  - Elements: imageViewUserPicture, cardViewProfile
  - Methods: setImageURI(), load(), show(), dismiss(),
    updateUserProfilePicture()
}

class "Controller" as Controller {
  - Classes: ChangeProfilePicControl.java, ProfileFragment.java
  - Methods: selectImage(), onActivityResult(), uploadImage(),
    updateProfilePicture(), onCreateView(), setOnClickListener()
}

Model --> Controller : provides storage
Controller --> View : updates UI
View --> Controller : user input

@enduml
```

### Sequence Diagram

```plantuml
@startuml Change Profile Picture Sequence Diagram

actor User
participant ProfileFragment
participant ChangeProfilePicControl
participant FirebaseStorage
participant FirebaseDatabase

User -> ProfileFragment: Click profile picture
ProfileFragment -> ChangeProfilePicControl: selectImage()
ChangeProfilePicControl -> ProfileFragment: Start image picker intent
User -> ChangeProfilePicControl: Select image from gallery
ChangeProfilePicControl -> ChangeProfilePicControl: onActivityResult()
ChangeProfilePicControl -> FirebaseStorage: Upload image file
FirebaseStorage --> ChangeProfilePicControl: Upload success
ChangeProfilePicControl -> FirebaseStorage: Get download URL
FirebaseStorage --> ChangeProfilePicControl: Return image URL
ChangeProfilePicControl -> FirebaseDatabase: Update profileImageUrl
FirebaseDatabase --> ChangeProfilePicControl: Update success
ChangeProfilePicControl -> ProfileFragment: Update UI with new image
ChangeProfilePicControl -> ProfileFragment: Dismiss progress dialog

@enduml
```

### Data Design Diagram

```plantuml
@startuml Change Profile Picture Data Design Diagram

database "Firebase Storage" as Storage {
  profile_pictures/{userId} : image file
  +getDownloadUrl(): String
  +putFile(uri): UploadTask
}

database "users/{userId}" as UserDB {
  userId : String <<PK>>
  profileImageUrl : String
}

class ImageUpload {
  +selectedImageUri : Uri
  +uploadedImageUrl : String
  +uploadProgress : int
}

Storage --> ImageUpload : stores file
ImageUpload --> UserDB : saves URL
UserDB --> ProfileFragment : displays image

@enduml
```
