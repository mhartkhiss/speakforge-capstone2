# 1.4 Forgot Password

## Front-end Components

- **ForgotPasswordActivity**: Main password recovery screen extending BaseAuthActivity
  - Email EditText: Input field for registered email address
  - Reset Password Button: Triggers password reset email process
  - Back to Login TextView: Link to return to login screen
  - Email Sent Label: Confirmation message displayed after successful reset

- **BaseAuthActivity**: Base class providing common authentication UI elements
  - Logo ImageView: App branding with scale-fade animations
  - Form container: Holds recovery form with slide-up animation
  - Keyboard visibility handling for dynamic UI adjustments

- **UI Components**:
  - ProgressDialog: Loading indicator during email sending
  - CustomDialog: Error message displays
  - CountDownTimer: Rate limiting timer preventing spam reset requests
  - AnimationUtils: Scale-fade and slide-up transitions

## Back-end Components

- **FirebaseAuth**: Firebase authentication service
  - sendPasswordResetEmail(): Sends password recovery email to user
  - onCompleteListener: Handles email sending completion
  - Exception handling for network or service errors

- **FirebaseDatabase**: Real-time database for email verification
  - users collection query: Checks if email exists in registered users
  - orderByChild("email"): Database query by email field
  - equalTo(emailAddress): Filters results to specific email
  - ValueEventListener: Handles database query completion

- **Rate Limiting Logic**: Prevents abuse of password reset functionality
  - CountDownTimer: 60-second cooldown between reset attempts
  - Button state management: Disables reset button during cooldown
  - Timer display: Shows remaining cooldown time to user

## Plant UML Diagrams

### Class Diagram (MVC Model)

```plantuml
@startuml Forgot Password Class Diagram

class "Model" as Model {
  - Classes: FirebaseAuth.java, FirebaseDatabase.java,
    CountDownTimer.java
  - Methods: sendPasswordResetEmail(), getReference(),
    orderByChild(), equalTo(), start(), cancel(),
    onTick(), onFinish()
}

class "View" as View {
  - Classes: ForgotPasswordActivity.java, BaseAuthActivity.java,
    ProgressDialog.java, CustomDialog.java
  - Layouts: activity_forgot_password.xml
  - Elements: email, btnResetPassword, txtEmailSent, 
    txtBackToLogin, speakForgeLogo, forgotPasswordFormContainer
  - Methods: show(), dismiss(), showDialog(), setText()
}

class "Controller" as Controller {
  - Classes: ForgotPasswordActivity.java, BaseAuthActivity.java
  - Methods: onCreate(), setListeners(), resetPassword(),
    sendResetEmail(), startTimer(), goToLoginActivity(),
    setupKeyboardVisibilityListener()
}

Model --> Controller : provides data
Controller --> View : updates UI
View --> Controller : user input

@enduml
```

### Sequence Diagram

```plantuml
@startuml Forgot Password Sequence Diagram

actor User
participant ForgotPasswordActivity
participant FirebaseDatabase
participant FirebaseAuth
participant CountDownTimer

User -> ForgotPasswordActivity: Enter email and click reset
ForgotPasswordActivity -> FirebaseDatabase: Check if email exists
FirebaseDatabase --> ForgotPasswordActivity: Email found
ForgotPasswordActivity -> FirebaseAuth: sendPasswordResetEmail()
FirebaseAuth --> ForgotPasswordActivity: Email sent
ForgotPasswordActivity -> CountDownTimer: Start 60s cooldown
CountDownTimer --> ForgotPasswordActivity: Timer expired

@enduml
```

### Data Design Diagram

```plantuml
@startuml Forgot Password Data Design Diagram

database "Firebase Auth" as Auth {
  userId : String <<PK>>
  email : String <<unique>>
  passwordResetToken : String
  resetTokenExpiry : timestamp
}

database "users" as Users {
  email : String <<indexed>>
  userId : String <<PK>>
  username : String
  accountType : String
  createdAt : String
  lastLoginDate : String
}

class ResetRequest {
  +email : String
  +timestamp : long
  +attempts : int
}

class RateLimiter {
  +cooldownPeriod : long = 60000
  +maxAttempts : int = 3
  +isAllowed(email: String): boolean
}

Users --> Auth : verifies user exists
ResetRequest --> RateLimiter : checked against
RateLimiter --> ResetRequest : controls access

@enduml
```